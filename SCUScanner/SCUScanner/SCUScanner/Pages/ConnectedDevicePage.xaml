<?xml version="1.0" encoding="utf-8" ?>
<pages:BaseTabPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:SCUScanner.Helpers"
              xmlns:pages="clr-namespace:SCUScanner.Pages"
             x:Class="SCUScanner.Pages.ConnectedDevicePage"
                   x:Name="ConnectedDevice">
    <ContentPage.Content>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
                
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Label Grid.Column="0"  Grid.Row="0" Text="{Binding  Resources[StatusText]}"/>
            <Label Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="0" Text="{Binding  ConnectText}" TextColor="Red"/>
            <Button Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="0"   Text="{Binding DeviceViewModel.ConnectButtonText}"
                    Command="{Binding DisconnectCommand}" FontSize="Small"  IsEnabled="{Binding DeviceViewModel.IsConnected}"/>
            <Label Grid.Column="0" Grid.Row="1" Text="RSSI"/>
            <Label Text="{Binding Rssi}" Grid.Row="1" Grid.Column="1" TextColor="Red" />
            <Label Text="{Binding Address, StringFormat='Address: {0}'}" Grid.Row="1" Grid.Column="2" FontAttributes="Italic" />

            <controls:ListViewEx
                     ItemsSource="{Binding GattCharacteristics}"
                     IsGroupingEnabled="true"
                     GroupDisplayBinding="{Binding Name}"
                     ItemClickCommand="{Binding SelectCharacteristic}"
                     HasUnevenRows="true"
                    Grid.Column="0"  Grid.ColumnSpan="4"
                    Grid.Row="2"
                    
                    VerticalOptions="FillAndExpand"
                HorizontalOptions="FillAndExpand"
            >
            <ListView.GroupHeaderTemplate>
                <DataTemplate>
                        <ViewCell  Height="30">
                            
                                <ContentView Padding="20,0,0,0">
                                    <Label Text="{Binding Name, StringFormat='Service {0}'}"  FontAttributes="Bold" TextColor="Blue"/>
                                </ContentView>
                            
                        </ViewCell>
                    </DataTemplate>
            </ListView.GroupHeaderTemplate>
            <ListView.ItemTemplate>
                <DataTemplate>
                        <ViewCell >
                    
                        <ViewCell.View >
                            <StackLayout >
                                    <StackLayout Orientation="Horizontal">
                                        <Label Text="CanRead" IsEnabled="{Binding CanRead}"/>
                                        <Label Text="CanWrite" IsEnabled="{Binding CanWrite}"/>
                                        <Label Text="CanNotify" IsEnabled="{Binding CanNotify}"/>
                                    </StackLayout>
                                    <!--<Label Text="{Binding Description}" FontAttributes="Bold" TextColor="Red" />-->
                                    <Label Text="{Binding Uuid, StringFormat='UUID: {0}'}" FontAttributes="Italic" />
                                
                                <Label Text="{Binding IsNotifying, StringFormat='Notifying: {0}'}" IsVisible="{Binding CanNotify}" />
                                <Label Text="{Binding Value, StringFormat='Read value: {0}'}"   />
                                <Label Text="{Binding LastValue, StringFormat='Last Read: {0:hh:mm:ss tt}'}"   />
                                 <Label Text="Please enter a write value" IsVisible="{Binding CanWrite}" />
                                <StackLayout Orientation="Horizontal" >
                                        <Button Text="Read"  Command="{Binding  ReadCommand}" />
                                        <Entry HeightRequest="50" WidthRequest="150" Text="{Binding ValueToWrite}" IsVisible="{Binding CanWrite}"/>
                                        <Button Text="Send"  Command="{Binding  SendCommand }" IsVisible="{Binding CanWrite}"/>
                                 </StackLayout>

                                </StackLayout>
                        </ViewCell.View>
                    
                        </ViewCell>
                    </DataTemplate>
            </ListView.ItemTemplate>
        </controls:ListViewEx>
        </Grid>
    </ContentPage.Content>
    
</pages:BaseTabPage>